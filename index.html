<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diwali Trivia Party</title>
  <style>
    :root{
      --bg1:#6b1a6b; --bg2:#c92e7d; --fg:#fff7e6; --accent:#ffd000; --accent2:#ff4db8; --accent3:#00d9c8; --danger:#ff4d6d; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,Noto Sans,"Apple Color Emoji","Segoe UI Emoji";background:radial-gradient(1200px 800px at 20% 0%,var(--bg2),transparent),radial-gradient(1000px 700px at 80% 100%,#8b2c8b,transparent),linear-gradient(135deg,var(--bg1),#4a0e4a 60%);color:var(--fg);display:grid;place-items:center;overflow:hidden;position:relative;}
    html::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 20% 50%, rgba(255,208,0,0.05) 0%, transparent 50%),radial-gradient(circle at 80% 20%, rgba(255,77,184,0.06) 0%, transparent 50%),radial-gradient(circle at 50% 80%, rgba(0,217,200,0.05) 0%, transparent 50%);animation:shimmer 20s ease-in-out infinite;pointer-events:none;z-index:0;}
    @keyframes shimmer{0%,100%{opacity:0.3;transform:scale(1) rotate(0deg);}50%{opacity:0.6;transform:scale(1.1) rotate(2deg);}}
    .wrap{width:min(1600px,95vw);height:min(95vh,900px);position:relative;z-index:1;}
    .card{position:absolute;inset:0;display:grid;grid-template-rows:auto 1fr auto;gap:1.2rem;background:rgba(255,255,255,0.05);border:6px solid rgba(255,208,0,0.2);border-radius:28px;padding:clamp(16px,3vw,36px);box-shadow:var(--shadow);backdrop-filter:blur(6px);}
    header{display:flex;align-items:center;justify-content:space-between;gap:1rem;}
    .title{display:flex;align-items:center;gap:.6rem;font-weight:900;letter-spacing:.5px;}
    .title .logo{font-size:clamp(24px,4vw,40px);} .title .text{font-size:clamp(20px,2.6vw,34px);} .subtle{opacity:.8;font-size:clamp(12px,1.5vw,16px)}
    .qa{display:grid;align-content:center;text-align:center;padding:clamp(8px,2vw,16px);} 
    .intro-view{display:none;} .intro-view.show{display:block;animation:fadeIn .5s ease-out;}
    .intro-content{max-width:700px;margin:0 auto;padding:clamp(16px,3vw,32px);}
    .intro-emoji{font-size:clamp(48px,8vw,80px);margin-bottom:clamp(16px,2vh,24px);}
    .intro-title{font-size:clamp(36px,6vw,64px);font-weight:900;line-height:1.1;margin:0 0 clamp(12px,2vh,20px) 0;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .intro-text{font-size:clamp(18px,2.5vw,26px);margin:0 0 clamp(24px,4vh,40px) 0;opacity:0.95;}
    .intro-instructions{text-align:left;background:rgba(255,255,255,0.05);border:2px solid rgba(255,208,0,0.15);border-radius:16px;padding:clamp(16px,2vw,24px);margin-bottom:clamp(24px,4vh,40px);}
    .intro-instructions p{margin:0 0 clamp(8px,1.5vh,12px) 0;font-size:clamp(16px,2vw,20px);font-weight:700;color:var(--accent);}
    .intro-instructions ul{margin:0;padding-left:clamp(20px,3vw,28px);list-style:none;}
    .intro-instructions li{margin-bottom:clamp(6px,1vh,10px);font-size:clamp(14px,1.8vw,18px);line-height:1.5;position:relative;padding-left:clamp(16px,2vw,20px);}
    .intro-instructions li::before{content:'‚úì';position:absolute;left:0;color:var(--accent3);font-weight:bold;}
    .ctrl-large{font-size:clamp(18px,2.2vw,24px)!important;padding:0.8em 1.5em!important;margin-top:clamp(8px,1.5vh,16px);}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .question-view{display:block;} .question-view.hidden{display:none!important;}
    .question-image{max-width:100%;max-height:50vh;margin:clamp(16px,3vh,24px) auto;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,0.3);display:block;object-fit:contain;}
    .answer-view{display:none;text-align:left;} .answer-view.show{display:block!important;animation:slideIn .3s ease-out;}
    .q{font-weight:800;line-height:1.15;font-size:clamp(28px,5.2vw,66px);text-wrap:balance;} 
    .answer-title{font-weight:800;line-height:1.2;font-size:clamp(32px,5vw,56px);color:var(--accent);text-shadow:0 2px 0 #0006;margin-bottom:clamp(16px,3vh,24px);text-align:center;}
    .answer-facts{font-size:clamp(16px,2.2vw,22px);line-height:1.5;color:var(--fg);opacity:0.95;}
    .answer-facts h3{color:var(--accent2);font-size:clamp(20px,2.8vw,28px);margin:clamp(12px,2vh,20px) 0 clamp(8px,1.5vh,12px) 0;font-weight:700;}
    .answer-facts ul{margin:clamp(8px,1.5vh,12px) 0;padding-left:clamp(16px,3vw,24px);}
    .answer-facts li{margin-bottom:clamp(6px,1vh,10px);}
    @keyframes slideIn{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    footer{display:flex;align-items:center;justify-content:space-between;gap:1rem;} footer.hidden{display:none!important;} .controls{display:flex;flex-wrap:wrap;gap:.5rem;} button.ctrl{font-size:clamp(14px,1.6vw,18px);font-weight:700;color:#0b0814;background:linear-gradient(180deg,var(--accent),#ff9d00);border:none;border-radius:14px;padding:.6em .9em;cursor:pointer;box-shadow:var(--shadow);} button.ctrl.secondary{background:linear-gradient(180deg,#ffe8b5,#ffd270);} button.ctrl.ghost{background:#ffffff10;color:var(--fg);border:2px solid #ffffff30;} button.ctrl:active{transform:translateY(1px);} .idx{font-weight:700;opacity:.9;}
    .tips{display:none;}
    .hidden{display:none!important;} .pill{padding:.25em .6em;border-radius:999px;background:#ffffff22;}
    .modal{position:fixed;inset:0;display:none;place-items:center;background:#000a;z-index:10;} .modal .box{width:min(1200px,92vw);max-height:90vh;overflow:auto;background:#111a;border:2px solid #fff3;padding:1rem;border-radius:18px;} .modal textarea{width:100%;height:50vh;font:14px/1.4 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:#fff;background:#000;border:1px solid #444;border-radius:12px;padding:10px;} .modal .row{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem}
    ::-webkit-scrollbar{width:10px;height:10px} ::-webkit-scrollbar-thumb{background:#ffffff33;border-radius:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="title"><div class="logo">ü™î</div><div class="text">Diwali Trivia Party</div></div>
        <div class="subtle">Use <span class="pill">Space</span> to reveal ‚Ä¢ <span class="pill">‚Üê/‚Üí</span> to navigate ‚Ä¢ <span class="pill">F</span> fullscreen</div>
      </header>
      <main class="qa" role="main" aria-live="polite">
        <div class="intro-view" id="introView">
          <div class="intro-content">
            <div class="intro-emoji">ü™î‚ú®</div>
            <h1 class="intro-title">Welcome to Diwali Trivia!</h1>
            
            <button class="ctrl ctrl-large" id="startBtn">üéâ Start Quiz</button>
          </div>
        </div>
        <div class="question-view" id="questionView">
          <div class="q" id="q">Loading‚Ä¶</div>
        </div>
        <div class="answer-view" id="answerView">
          <div class="answer-title" id="answerTitle"></div>
          <div class="answer-facts" id="answerFacts"></div>
        </div>
      </main>
      <footer id="footer">
        <div class="controls">
          <button class="ctrl ghost" id="prev">‚óÄ Prev</button>
          <button class="ctrl" id="reveal">üéá Show Answer</button>
          <button class="ctrl ghost" id="next">Next ‚ñ∂</button>
          <button class="ctrl secondary" id="shuffle">üîÄ Shuffle</button>
          <button class="ctrl ghost" id="autoplay">‚ñ∂Ô∏é Auto</button>
          <button class="ctrl ghost" id="fs">‚õ∂ Fullscreen</button>
          <!-- <button class="ctrl ghost" id="importBtn">‚¨á Import</button>
          <button class="ctrl ghost" id="exportBtn">‚¨Ü Export</button>
          <button class="ctrl ghost" id="helpBtn">‚ìò Help</button> -->
        </div>
        <div class="idx" id="idx">1 / 1</div>
      </footer>
      <div class="tips"></div>
    </div>
  </div>
  <div class="modal" id="modal"><div class="box"><h2 style="margin:0 0 .5rem 0">Edit Questions (JSON)</h2>        <p style="margin:.2rem 0 .8rem 0;opacity:.9">Paste an object with categories like <code>{"Food": [{"q":"Question","a":"Answer","facts":"HTML content with facts"}], "Gods": [...]}</code>. Your list is saved to <b>localStorage</b> only on this device.</p><textarea id="jsonArea"></textarea><div class="row"><button class="ctrl" id="saveJson">üíæ Save</button><button class="ctrl ghost" id="closeJson">Close</button><input type="file" accept="application/json" id="fileInput" class="hidden" /><button class="ctrl secondary" id="loadFile">üìÅ Load .json file</button></div></div></div>
  <script>
    let DEFAULT_QA = null;
    
    // Load questions from external JSON file
    async function loadDefaultQuestions() {
      try {
        const response = await fetch('questions.json');
        if (!response.ok) throw new Error('Failed to load questions');
        DEFAULT_QA = await response.json();
        console.log('Loaded questions from JSON file:', DEFAULT_QA);
        console.log('Total questions loaded:', Object.keys(DEFAULT_QA).reduce((sum, cat) => sum + DEFAULT_QA[cat].length, 0));
        initializeApp();
      } catch (error) {
        console.error('Error loading questions:', error);
        // Fallback to minimal inline questions if external file fails
        DEFAULT_QA = {
          "Food": [{q:"What sweet treat is popular during Diwali?",a:"Gulab Jamun",facts:"<p>Sweet milk-based dessert.</p>"}],
          "Language": [{q:"What does 'Diwali' mean?",a:"Row of lights",facts:"<p>From Sanskrit deepavali.</p>"}],
          "Gods": [{q:"Which goddess is worshipped during Diwali?",a:"Goddess Lakshmi",facts:"<p>Goddess of wealth and prosperity.</p>"}]
        };
        console.warn('Using fallback questions');
        initializeApp();
      }
    }
    
    function initializeApp() {
    const LS_KEY='diwali_trivia_qa_v1';const LS_IDX='diwali_trivia_idx_v1';const LS_ORDER='diwali_trivia_order_v1';const LS_AUTOPLAY='diwali_trivia_autoplay_v1';const LS_INTRO='diwali_trivia_intro_seen_v1';
    let qaData=loadQA();let qa=flattenQA(qaData);let order=[...Array(qa.length).keys()];let idx=0;let showAnswer=false;let autoplay=false;let intervalMs=12000;let timer=null;let quizStarted=false;
    const qEl=document.getElementById('q');const idxEl=document.getElementById('idx');
    const footer=document.getElementById('footer');
    const introView=document.getElementById('introView');const startBtn=document.getElementById('startBtn');
    const questionView=document.getElementById('questionView');const answerView=document.getElementById('answerView');const answerTitle=document.getElementById('answerTitle');const answerFacts=document.getElementById('answerFacts');
    const btnPrev=document.getElementById('prev');const btnNext=document.getElementById('next');const btnReveal=document.getElementById('reveal');const btnShuffle=document.getElementById('shuffle');const btnAuto=document.getElementById('autoplay');const btnFS=document.getElementById('fs');const btnImport=document.getElementById('importBtn');const btnExport=document.getElementById('exportBtn');const btnHelp=document.getElementById('helpBtn');const modal=document.getElementById('modal');const jsonArea=document.getElementById('jsonArea');const btnSaveJson=document.getElementById('saveJson');const btnCloseJson=document.getElementById('closeJson');const fileInput=document.getElementById('fileInput');const btnLoadFile=document.getElementById('loadFile');
    checkIntro();
    startBtn.onclick=startQuiz;
    btnPrev.onclick=prev;btnNext.onclick=next;btnReveal.onclick=toggleAnswer;btnShuffle.onclick=shuffleAll;btnAuto.onclick=toggleAutoplay;btnFS.onclick=toggleFullscreen;btnImport.onclick=openEditor;btnExport.onclick=exportJson;btnHelp.onclick=showHelp;btnSaveJson.onclick=saveJson;btnCloseJson.onclick=closeEditor;btnLoadFile.onclick=()=>fileInput.click();fileInput.onchange=onFileImport;
    window.onkeydown=e=>{if(!quizStarted&&e.key.toLowerCase()==='enter'){e.preventDefault();startQuiz();return;}if(!quizStarted)return;const k=e.key.toLowerCase();if(['arrowright','enter'].includes(k)){e.preventDefault();if(!showAnswer)toggleAnswer();else next();}if(k===' '){e.preventDefault();toggleAnswer();}if(['arrowleft','backspace'].includes(k)){e.preventDefault();prev();}if(k==='r'){shuffleAll();}if(k==='a'){toggleAutoplay();}if(k==='f'){toggleFullscreen();}if(k==='i'){openEditor();}if(k==='+'){intervalMs=Math.max(4000,intervalMs-1000);updateAutoplay(true);}if(k==='-'){intervalMs=Math.min(30000,intervalMs+1000);updateAutoplay(true);}if(k==='h'){showHelp();}};
    document.querySelector('.qa').onclick=e=>{if(quizStarted&&(e.target.closest('.question-view')||e.target.closest('.answer-view'))){toggleAnswer();}};
    function checkIntro(){showIntro();}
    function showIntro(){quizStarted=false;introView.classList.add('show');questionView.classList.add('hidden');answerView.classList.remove('show');footer.classList.add('hidden');}
    function startQuiz(){
      quizStarted=true;
      introView.classList.remove('show');
      questionView.classList.remove('hidden');
      footer.classList.remove('hidden');
      // Reload questions to get fresh data
      qaData=loadQA();
      qa=flattenQA(qaData);
      order=[...Array(qa.length).keys()];
      idx=0;
      showAnswer=false;
      render();
      updateAutoplay();
    }
    function flattenQA(qaData){const flat=[];Object.keys(qaData).forEach(category=>{qaData[category].forEach(item=>{flat.push({...item,category});});});return flat;}
    function render(){
      const i=order[idx];
      const item=qa[i];
      let questionHTML=`<div style="color:var(--accent2);font-size:0.6em;margin-bottom:0.5em;opacity:0.9;font-weight:600;">${item.category}</div>`;
      if(item.image){
        questionHTML+=`<img src="${item.image}" alt="Question image" class="question-image" onerror="this.style.display='none'">`;
      }
      questionHTML+=item.q;
      qEl.innerHTML=questionHTML;
      answerTitle.textContent=item.a||'';
      answerFacts.innerHTML=item.facts||'<p>No additional facts available.</p>';
      if(showAnswer){
        questionView.classList.add('hidden');
        answerView.classList.add('show');
        btnReveal.textContent='üîô Back to Question';
      }else{
        questionView.classList.remove('hidden');
        answerView.classList.remove('show');
        btnReveal.textContent='üéá Show Answer';
      }
      idxEl.textContent=`${idx+1} / ${qa.length}`;
      localStorage.setItem(LS_IDX,String(idx));
    }
    function next(){showAnswer=false;idx=(idx+1)%qa.length;render();resetAutoplayTick();}
    function prev(){showAnswer=false;idx=(idx-1+qa.length)%qa.length;render();resetAutoplayTick();}
    function toggleAnswer(){showAnswer=!showAnswer;render();resetAutoplayTick();}
    function shuffleAll(){order=shuffle([...Array(qa.length).keys()]);idx=0;showAnswer=false;render();}
    function toggleAutoplay(){autoplay=!autoplay;localStorage.setItem(LS_AUTOPLAY,autoplay?'1':'0');updateAutoplay();}
    function updateAutoplay(bump){btnAuto.textContent=autoplay?`‚è∏ Auto (${Math.round(intervalMs/1000)}s)`:'‚ñ∂Ô∏é Auto';if(autoplay){clearInterval(timer);timer=setInterval(()=>{if(!showAnswer){toggleAnswer();}else{next();}},intervalMs);}else{clearInterval(timer);timer=null;}}
    function resetAutoplayTick(){if(autoplay){updateAutoplay(true);}}
    function toggleFullscreen(){const el=document.documentElement;if(!document.fullscreenElement){el.requestFullscreen?.();}else{document.exitFullscreen?.();}}
    function openEditor(){jsonArea.value=JSON.stringify(qaData,null,2);modal.style.display='grid';}
    function closeEditor(){modal.style.display='none';}
    function saveJson(){try{const parsed=JSON.parse(jsonArea.value);if(typeof parsed!=='object'||parsed===null)throw new Error('JSON must be an object with categories');const cleaned={};let totalItems=0;Object.keys(parsed).forEach(category=>{if(!Array.isArray(parsed[category]))throw new Error(`Category '${category}' must be an array`);const categoryItems=parsed[category].map(o=>({q:String(o.q||'').trim(),a:String(o.a||'').trim(),facts:o.facts||''})).filter(o=>o.q);if(categoryItems.length>0){cleaned[category]=categoryItems;totalItems+=categoryItems.length;}});if(totalItems===0)throw new Error('No valid items. Include objects with {q, a, facts} in categories.');qaData=cleaned;qa=flattenQA(qaData);order=[...Array(qa.length).keys()];idx=0;showAnswer=false;localStorage.setItem(LS_KEY,JSON.stringify(qaData));render();closeEditor();}catch(err){alert('Invalid JSON: '+err.message);}}
    function exportJson(){const blob=new Blob([JSON.stringify(qaData,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='diwali-trivia-qa.json';a.click();URL.revokeObjectURL(url);}
    function onFileImport(e){const file=e.target.files?.[0];if(!file)return;const reader=new FileReader();reader.onload=()=>{jsonArea.value=String(reader.result||'');};reader.readAsText(file);}
    function loadQA(){console.log('Using DEFAULT_QA from JSON file');return DEFAULT_QA;}
    function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
    function showHelp(){alert(`Controls:\n\nSpace / Click  ‚Äî Reveal/Hide answer\n‚Üí / Enter       ‚Äî Reveal then Next\n‚Üê / Backspace   ‚Äî Previous\nR               ‚Äî Shuffle order\nA               ‚Äî Toggle Auto-play\n+ / -           ‚Äî Auto speed ¬±1s (4‚Äì30s)\nF               ‚Äî Fullscreen\nI               ‚Äî Import / Edit JSON\nH               ‚Äî This help`);}
    }
    
    // Load questions and start the app
    loadDefaultQuestions();
  </script>
</body>
</html>